# 쿠폰 서비스

## 요구 사항(목적)

- 사용자에게 할인, 선물 등 쿠폰을 제공하는 서비스를 개발
- 기능 명세에 대한 개발 및 테스트

## 기능 명세

- 필수
    1. 랜덤한 코드의 쿠폰을 N개 생성하여 데이터베이스에 보관하는 API를 구현
        - input: N
    2. 생성된 쿠폰 중 하나를 사용자에게 지급하는 API를 구현
        - output: 쿠폰 번호(XXXXX-XXXXXX-XXXXXXXX)
    3. 사용자에게 지급된 쿠폰을 조회하는 API를 구현
    4. 지급된 쿠폰 중 하나를 사용하는 API를 구현(쿠폰 재사용은 불가)
        - input : 쿠폰 번호
    5. 지급된 쿠폰 중 하나를 사용 취소하는 API를 구현(취소된 쿠폰 재사용 가능)
        - input : 쿠폰 번호
    6. 발급된 쿠폰 중 당일 만료된 전체 쿠폰 목록을 조회하는 API를 구현

- 선택
    1. 발급된 쿠폰 중 만료 3일전 사용자에게 메세지("쿠폰이 3일 후 만료됩니다.")를 발송하는 기능을 구현
        - 실제로 메세지를 발송하는 것이 아닌 stdout 등으로 출력

## 제약 사항

- 필수
    1.  기능 명세에 제시한 기능 개발
    2. 단위 테스트(Unit Test) 코드를 개발하여 각 기능을 검증
    3. 프로그래밍 언어는 자유롭게 선택
    4. 각 API의 HTTP Method들(GET | POST | PUT | DEL)은 자유롭게 선택
    5. README.md 파일을 추가하여, 개발 프레임워크, 문제해결 전략, 빌드 및 실행 방법을 기술
- 선택
    1. API 인증을 위해 JWT(Json Web Token)를 이용해서 Token 기반 API 인증 기능을 개발하고 각 API 호출시에 HTTP Header에 발급된 토큰을 가지고 호출
        - signup 계정 생성 API : ID, PW를 입력 받아 내부 DB에 계정을 저장하고 토큰을 생성하여 출력
            - 단, 패스워드는 안전한 방법으로 저장
        - signin 로그인 API : 입력으로 생성된 계정(ID, PW)으로 로그인 요청하면 토큰을 발급
    2. 100억개 이상 쿠폰 저장 관리 가능하도록 구현
    3. 10만개 이상 벌크 csv Import 기능
    4. 대용량 트래픽(TPS 10K 이상)을 고려한 시스템 구현
    5. 성능 테스트 결과 / 피드백

## 문제 해결 전략

- 랜덤한 쿠폰 번호 생성(추후 생성 전략 변경 고려)
    - `org.apache.commons:commons-lang3:3.4` 라이브러리를 이용해서 RandomString을 생성
    - 형식
        - 영문 대소문자, 숫자를 이용해 4자리 RandomString을 생성하고 이 과정을 5번 반복해서 dash("-")가 포함된 24자리 문자열 생성
        - OOOO-OOOO-OOOO-OOOO-OOOO
            - ex. Asdf-12da-CCaa-2Ada-zad2
    - 영문 대문자(26개) + 영문 소문자(26개) + 숫자(0~9, 10개)로 총 62개로 중복을 허용한 4자리 문자열을 만들면 `62 * 62 * 62 * 62 = 14,776,336` 경우의 문자열을 생성 가능
- 데이터베이스에 저장된 쿠폰에 Status 컬럼을 넣어서 상태 값에 따른 처리를 할 수 있도록 제어
    - Status 종류
        - **CREATED** : 쿠폰이 최초 생성됨
        - **PUBLISHED** : 쿠폰이 특정 사용자에게 지급됨(만료일이 지정됨)
        - **USED** : 쿠폰이 사용됨(재사용 불가, 취소하면 재사용 가능)
        - **EXPIRED** : 쿠폰이 사용되지 않고 만료됨(배치로 EXPIRED 상태로 만들 예정)
        
## 고려 사항

- findByCode로 Database에서 해당 코드를 조회할 때, 해당 Entity의 Status가 PUBLISHED 일 경우에 ExpirationDate를 조회해서 만료일이 조회한 시점에 지났을 경우 Status를 EXPIRED로 변경
    - 이렇게 하면 배치로 EXPIRED로 만들 row가 줄어들 것으로 예상됨